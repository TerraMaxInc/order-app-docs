---
title: Update Mail Daemon Client Secret
format: html
---

The HubSpot Service's ability to send emails from the `tech@terramax.com` email requires extra permission that had to be given by Coordinated.  Technically, this permission is granted to the app *registration*, and so for the actual app to use it, it needs to connect via the client secret.  

The client secret is like an access token; the registration generates and provides it, and then the app holds onto it as an environmental variable so it can prove it has a right to the permissions listed in the registration.  Client Secrets come with expiration dates, and need to be refreshed.

When the HubSpot Service client secret gets close to expiry, you should recieve warning emails about it.  If it expires, then the backend [HubSpot Service](../architecture/azure/hubspot-service/hubspot-service-registration.html) won't be able to send emails, and the [Ordering App](../architecture/azure/ordering-app/ordering-app.html) and [Product Manager App](../architecture/azure/) that depend on it will not be able to perform all their functions correctly.

## 1. Find `terramax-hubspot-service-registration` in the Azure Portal

- In the Azure Portal, go to:
    - Entra > App registrations > terramax-hubspot-service-registration
![There should be a warning symbol next to `terramax-hubspot-service-registration` in the list of applications](images/AZ_expired_certificate.png)

## 2. Find the Expired Client Secret

- In the App Registration, you should see a warning with a direct link like this:
![Warning displayed at the top of the App Registration Overview](images/AZ_expired_certificate02.png)
- You can also find the Client Secret by going to:
    - Manage > Certificates & Secrets

## 3. Create New Client Secret

- In *Secrets & Certificates* you should see the expired Secret.  You can't renew it directly, you can to make a new one instead.  Click the *New client secret* button
![Click the New client secret button](images/AZ_new_client_secret.png)
- Give it a description like the previous secret, set the expiration, and click *Add*
- Copy the secret so you can paste it into the app's environmental variables
![Copy the secret](images/AZ_copy_client_secret.png)

## 4. Add New Secret to `terramax-hubspot-service` in Azure

- Leave Entra and go back to the main Azure Portal page, and find `terramax-hubspot-service` in the list of Resources
- Go to Settings > Environmental Variables and find `CLIENT_SECRET`
![CLIENT_SECRET in terramax-hubspot-service](images/AZ_env_client_secret.png)
- Select `CLIENT_SECRET`, and pasted the new value into the `Value` field
![Paste the new secret into the Value field](images/AZ_env_edit_client_secret.png)
- Click *Apply*

## 5. Add New Secret to Codebase .env File

- Open `hubspot-service` in VSCode and open the `.env` file at the root of the project
- Find the `CLIENT_SECRET` variable in .env, and replace the old value with the new one